# Discord Bot for OHBM Brainhack 2025

This Discord bot automatically manages project channels, roles, and member organization for the OHBM Brainhack event. It creates dedicated voice and text channels for each project and manages role-based access through emoji reactions.

## âœ¨ Features

- **ğŸ¤– Automatic Channel Creation**: Creates voice and text channels for each project
- **ğŸ‘¥ Role Management**: Creates project-specific roles (`proj-<projectname>`) for notifications
- **ğŸ˜„ Emoji-based Role Assignment**: Users react to messages to join project teams
- **ğŸ”’ Permission Management**: Ensures only project members can access their channels
- **ğŸ”„ Incremental Updates**: Gracefully handles new projects without disrupting existing assignments
- **ğŸ“Š Multi-Project Support**: Handles unlimited number of projects with automatic emoji assignment

## ğŸš€ Quick Start

### Prerequisites
- Python 3.8+
- Discord bot token
- GitHub personal access token
- Discord server with appropriate permissions

### Installation

1. **Install Dependencies**
   ```bash
   pip install -r requirements.txt
   ```

2. **Environment Setup**
   Create a `.env` file in the **project root directory** (not in discord_bot folder) with your credentials:
   ```env
   # Discord Bot Configuration
   DISCORD_TOKEN=your_bot_token_here
   DISCORD_GUILD_ID=your_server_id_here
   DISCORD_ROLES_CHANNEL=your_roles_channel_id_here
   
   # GitHub API Configuration (for fetchIssues.js)
   GH_AUTH=your_github_token_here
   ```

### ğŸ”‘ Getting Your Tokens

#### Discord Tokens
- **DISCORD_TOKEN**: [Discord Developer Portal](https://discord.com/developers/applications) â†’ Your Application â†’ Bot â†’ Token
- **DISCORD_GUILD_ID**: Right-click your Discord server â†’ Copy Server ID (requires Developer Mode enabled)
- **DISCORD_ROLES_CHANNEL**: Right-click the channel where users will react for roles â†’ Copy Channel ID

#### GitHub Token
- **GH_AUTH**: [GitHub Settings](https://github.com/settings/tokens) â†’ Personal Access Tokens â†’ Generate new token
- **Required scopes**: `public_repo` (to read issues from hackathon repository)

3. **Generate Project Data**
   From the project root directory:
   ```bash
   node scripts/fetchIssues.js
   ```

4. **Start the Bot**
   ```bash
   python main.py
   ```

## ğŸ“ File Structure

```
project_root/
â”œâ”€â”€ .env                    # Environment variables (create this)
â”œâ”€â”€ scripts/fetchIssues.js  # Data generation script
â”œâ”€â”€ src/_data/projects.yaml # Generated project data
â””â”€â”€ discord_bot/
    â”œâ”€â”€ main.py             # Bot entry point
    â”œâ”€â”€ projects_client.py  # Main bot functionality
    â”œâ”€â”€ cleanup_channels.py # Testing utility (removes channels only)
    â”œâ”€â”€ requirements.txt    # Python dependencies
    â””â”€â”€ README.md          # This file
```

## ğŸ”§ How It Works

### Data Flow
1. **fetchIssues.js** â†’ Fetches GitHub issues â†’ **projects.yaml**
2. **Discord Bot** â†’ Reads **projects.yaml** â†’ Creates channels/roles
3. **Users** â†’ React to emoji â†’ Get project roles â†’ Access channels

### Channel Organization
- **Projects** category: Voice channels for each project
- **Projects-text** category: Text channels for each project
- **Roles channel**: Where users react to join projects

### Permission System
- **@everyone**: Cannot see project channels
- **Event Staff**: Can see all project channels
- **proj-<projectname>**: Can see specific project channels
- **muted**: Cannot see any project channels

## ğŸ¯ Usage Scenarios

### First Time Setup
```bash
# Generate project data
node scripts/fetchIssues.js

# Start bot (creates all channels/roles)
cd discord_bot
python main.py
```

### Adding New Projects
```bash
# Add projects to GitHub issues
# Regenerate data
node scripts/fetchIssues.js

# Restart bot (only creates new projects)
python main.py
```

### Testing (Development Only)
```bash
# Clean up channels for testing
python cleanup_channels.py

# Test bot channel creation
python main.py
```

## ğŸ§ª Testing Tools

### cleanup_channels.py
**âš ï¸ FOR TESTING ONLY** - Removes all channels in "Projects" and "Projects-text" categories while preserving roles and user assignments. Used to test channel creation functionality.

## ğŸ“‹ Required Discord Setup

### Server Requirements
- **Categories**: `Projects`, `Projects-text` 
- **Roles**: `Event Staff`, `muted`
- **Channels**: A roles channel for emoji reactions

### Bot Permissions
- Manage Channels
- Manage Roles  
- Send Messages
- Add Reactions
- Read Message History
- View Channels

## ğŸ”„ Data Source

The bot reads project data from `../src/_data/projects.yaml`, generated by `fetchIssues.js`. This ensures consistency between the website and Discord server.

## ğŸ†˜ Troubleshooting

### Common Issues
- **"Event Staff role not found"**: Create a role named exactly "Event Staff"
- **Channels not created**: Check bot permissions and category existence
- **Unicode errors**: Ensure YAML file is UTF-8 encoded
- **Bot offline**: Verify token and guild ID in `.env`

## ğŸ” Security Notes

- Keep `.env` file secret and never commit it
- Use Discord's OAuth2 flow for production deployments
- Bot requires minimal permissions (no admin needed)
- All data is read-only from YAML files 